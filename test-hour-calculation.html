<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Calcolo Ora</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 14px;
            white-space: pre-wrap;
        }
        .hour-input {
            width: 100px;
            padding: 5px;
            margin: 5px;
        }
    </style>
</head>
<body>
    <h1>üïê Test Calcolo Ora</h1>
    
    <div class="test-section">
        <h2>Impostazioni Test</h2>
        <label>
            Ora del gioco: 
            <input type="number" id="gameHour" class="hour-input" min="0" max="23" value="10">
        </label>
        <label>
            Capacit√† mensile: 
            <input type="number" id="printCapacity" class="hour-input" value="168000">
        </label>
        <button onclick="testHourCalculation()">Calcola Produzione</button>
    </div>

    <div class="test-section">
        <h2>Risultati</h2>
        <div id="results" class="result">Clicca "Calcola Produzione" per vedere i risultati</div>
    </div>

    <script src="js/timeManager.js"></script>
    <script src="js/contractManager.js"></script>
    <script src="js/productionManager.js"></script>
    <script src="js/uiManager.js"></script>
    <script src="js/analysisManager.js"></script>
    <script src="js/dataManager.js"></script>
    <script src="js/eventManager.js"></script>
    <script src="js/settingsManager.js"></script>
    <script src="script.js"></script>

    <script>
        function testHourCalculation() {
            const gameHour = parseInt(document.getElementById('gameHour').value);
            const printCapacity = parseInt(document.getElementById('printCapacity').value);
            
            console.log('üß™ Test calcolo ora:', { gameHour, printCapacity });
            
            try {
                const app = new PrintingCapacityApp();
                app.gameDate = '2025-01';
                app.gameHour = gameHour;
                app.printCapacity = printCapacity;
                
                // Aggiungi un contratto di test
                const testContract = {
                    name: 'Test Contratto',
                    quantity: 300000,
                    deadline: '2025-03',
                    priority: 'normal'
                };
                
                app.contractManager.addContract(testContract);
                
                // Calcola l'analisi
                const analysis = app.analysisManager.calculateAnalysis(
                    app.contractManager.getContracts(),
                    app.gameDate,
                    app.printCapacity,
                    app.timeManager,
                    app.gameHour
                );
                
                console.log('üìä Analisi:', analysis);
                
                let resultText = `=== CALCOLO PRODUZIONE CON ORA ===\n\n`;
                resultText += `üïê Ora del gioco: ${gameHour}:00\n`;
                resultText += `üì¶ Capacit√† mensile: ${printCapacity.toLocaleString()}\n`;
                resultText += `üìã Contratto test: ${testContract.quantity.toLocaleString()} unit√†\n\n`;
                
                resultText += `=== CALCOLI TEORICI ===\n`;
                const dailyProduction = printCapacity / 30;
                const hoursRemaining = 24 - gameHour;
                const productionToday = (dailyProduction * hoursRemaining) / 24;
                const productionRemainingDays = dailyProduction * 29;
                const adjustedCapacity = productionToday + productionRemainingDays;
                
                resultText += `üìÖ Produzione giornaliera: ${dailyProduction.toLocaleString()}\n`;
                resultText += `‚è∞ Ore rimaste oggi: ${hoursRemaining}\n`;
                resultText += `üè≠ Produzione oggi: ${productionToday.toLocaleString()}\n`;
                resultText += `üìÜ Produzione giorni rimanenti: ${productionRemainingDays.toLocaleString()}\n`;
                resultText += `‚öôÔ∏è Capacit√† regolata: ${adjustedCapacity.toLocaleString()}\n\n`;
                
                resultText += `=== RISULTATI ANALISI ===\n`;
                resultText += `üìä Quantit√† totale: ${analysis.totalQuantity.toLocaleString()}\n`;
                resultText += `üìà Utilizzo capacit√†: ${analysis.capacityUsage}%\n`;
                resultText += `üóìÔ∏è Mesi necessari: ${analysis.monthsNeeded}\n`;
                resultText += `‚è≥ Mesi disponibili: ${analysis.monthsAvailable}\n`;
                resultText += `‚úÖ Fattibile: ${analysis.feasible ? 'S√å' : 'NO'}\n\n`;
                
                if (analysis.monthlySchedule && analysis.monthlySchedule.length > 0) {
                    resultText += `=== PROGRAMMAZIONE MENSILE ===\n`;
                    analysis.monthlySchedule.forEach((month, index) => {
                        resultText += `${month.month}: ${month.totalProduction.toLocaleString()}/${month.capacity.toLocaleString()} (${month.load.toFixed(1)}%)\n`;
                        if (index === 0) {
                            resultText += `  ‚Üë MESE CORRENTE (ora ${gameHour}:00)\n`;
                        }
                    });
                }
                
                document.getElementById('results').textContent = resultText;
                
            } catch (error) {
                console.error('‚ùå Errore test:', error);
                document.getElementById('results').textContent = `‚ùå Errore: ${error.message}`;
            }
        }
    </script>
</body>
</html>
