<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Debug Ora</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .controls {
            display: flex;
            gap: 20px;
            align-items: center;
            margin: 15px 0;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        input, select {
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>üïê Test Debug Calcolo Ora</h1>
    
    <div class="test-section">
        <h2>Controlli Test</h2>
        <div class="controls">
            <div class="control-group">
                <label>Ora del gioco:</label>
                <select id="gameHour">
                    <option value="0">00:00</option>
                    <option value="1">01:00</option>
                    <option value="2">02:00</option>
                    <option value="9" selected>09:00</option>
                    <option value="10">10:00</option>
                    <option value="12">12:00</option>
                    <option value="14">14:00</option>
                    <option value="18">18:00</option>
                    <option value="22">22:00</option>
                    <option value="23">23:00</option>
                </select>
            </div>
            <div class="control-group">
                <label>Capacit√† mensile:</label>
                <input type="number" id="printCapacity" value="168000">
            </div>
            <div class="control-group">
                <label>Data gioco:</label>
                <input type="text" id="gameDate" value="1999-01">
            </div>
        </div>
        <button onclick="testHourCalculation()">üß™ Test Calcolo</button>
        <button onclick="testApp()">üîç Test App Completa</button>
    </div>

    <div class="test-section">
        <h2>üìä Risultati Test</h2>
        <div id="results" class="result">Clicca "Test Calcolo" per vedere i risultati</div>
    </div>

    <div class="test-section">
        <h2>üìù Console Log</h2>
        <div id="consoleLog" class="result">I log della console appariranno qui</div>
    </div>

    <script src="js/timeManager.js"></script>
    <script src="js/contractManager.js"></script>
    <script src="js/productionManager.js"></script>
    <script src="js/uiManager.js"></script>
    <script src="js/analysisManager.js"></script>
    <script src="js/dataManager.js"></script>
    <script src="js/eventManager.js"></script>
    <script src="js/settingsManager.js"></script>
    <script src="script.js"></script>

    <script>
        // Cattura i log della console
        const originalLog = console.log;
        const consoleLog = document.getElementById('consoleLog');
        let logContent = '';
        
        console.log = function(...args) {
            const message = args.join(' ');
            logContent += message + '\n';
            consoleLog.textContent = logContent;
            consoleLog.scrollTop = consoleLog.scrollHeight;
            originalLog.apply(console, args);
        };

        function testHourCalculation() {
            const gameHour = parseInt(document.getElementById('gameHour').value);
            const printCapacity = parseInt(document.getElementById('printCapacity').value);
            const gameDate = document.getElementById('gameDate').value;
            
            logContent = ''; // Reset log
            console.log('üß™ === INIZIO TEST CALCOLO ORA ===');
            console.log(`Parametri: Ora=${gameHour}, Capacit√†=${printCapacity}, Data=${gameDate}`);
            
            // Test calcolo manuale
            const hoursInMonth = 30 * 24; // 720 ore al mese
            const hoursPassedToday = gameHour;
            const hoursRemaining = 24 - gameHour;
            const hourlyProduction = printCapacity / hoursInMonth;
            
            const productionPassedToday = hourlyProduction * hoursPassedToday;
            const productionRemainingToday = hourlyProduction * hoursRemaining;
            const productionRemainingDays = hourlyProduction * (29 * 24);
            const availableCapacity = productionRemainingToday + productionRemainingDays;
            
            console.log('üìä CALCOLO MANUALE:');
            console.log(`   Ore totali mese: ${hoursInMonth}`);
            console.log(`   Produzione oraria: ${hourlyProduction.toFixed(2)}`);
            console.log(`   Ore passate oggi: ${hoursPassedToday}`);
            console.log(`   Ore rimanenti oggi: ${hoursRemaining}`);
            console.log(`   Produzione persa oggi: ${productionPassedToday.toFixed(0)}`);
            console.log(`   Produzione rimanente oggi: ${productionRemainingToday.toFixed(0)}`);
            console.log(`   Produzione giorni rimanenti: ${productionRemainingDays.toFixed(0)}`);
            console.log(`   Capacit√† regolata: ${availableCapacity.toFixed(0)}`);
            console.log(`   Riduzione: ${(printCapacity - availableCapacity).toFixed(0)} (-${(((printCapacity - availableCapacity) / printCapacity) * 100).toFixed(1)}%)`);
            
            // Test con l'app
            try {
                const analysisManager = new AnalysisManager();
                const timeManager = new TimeManager();
                
                const testContracts = [{
                    id: 1,
                    name: 'snifferstop',
                    quantity: 298623,
                    deadline: '1999-02',
                    priority: 'normal',
                    completed: 0
                }];
                
                console.log('üîç TEST CON APP:');
                const analysis = analysisManager.calculateAnalysis(
                    testContracts,
                    gameDate,
                    printCapacity,
                    timeManager,
                    gameHour
                );
                
                console.log('üìã Risultato analisi:', analysis);
                
                // Mostra risultati nel DOM
                let resultText = `=== RISULTATI TEST CALCOLO ORA ===\n\n`;
                resultText += `üïê Ora del gioco: ${gameHour}:00\n`;
                resultText += `üì¶ Capacit√† mensile: ${printCapacity.toLocaleString()}\n`;
                resultText += `üìÖ Data gioco: ${gameDate}\n\n`;
                
                resultText += `=== CALCOLO MANUALE ===\n`;
                resultText += `üìä Capacit√† regolata: ${Math.floor(availableCapacity).toLocaleString()}\n`;
                resultText += `üìâ Riduzione: ${(printCapacity - availableCapacity).toFixed(0)} (-${(((printCapacity - availableCapacity) / printCapacity) * 100).toFixed(1)}%)\n\n`;
                
                resultText += `=== RISULTATI APP ===\n`;
                if (analysis.monthlySchedule && analysis.monthlySchedule.length > 0) {
                    const firstMonth = analysis.monthlySchedule[0];
                    resultText += `üìÖ Primo mese: ${firstMonth.month}\n`;
                    resultText += `üè≠ Capacit√† usata: ${firstMonth.capacity.toLocaleString()}\n`;
                    resultText += `üìä Produzione: ${firstMonth.totalProduction.toLocaleString()}\n`;
                    resultText += `‚ö° Carico: ${firstMonth.load.toFixed(1)}%\n`;
                } else {
                    resultText += `‚ùå Nessuna programmazione mensile generata\n`;
                }
                
                document.getElementById('results').textContent = resultText;
                
            } catch (error) {
                console.log(`‚ùå Errore test app: ${error.message}`);
                document.getElementById('results').textContent = `‚ùå Errore: ${error.message}`;
            }
        }

        function testApp() {
            const gameHour = parseInt(document.getElementById('gameHour').value);
            const printCapacity = parseInt(document.getElementById('printCapacity').value);
            const gameDate = document.getElementById('gameDate').value;
            
            logContent = ''; // Reset log
            console.log('üîç === TEST APP COMPLETA ===');
            
            try {
                const app = new PrintingCapacityApp();
                app.gameDate = gameDate;
                app.gameHour = gameHour;
                app.printCapacity = printCapacity;
                
                console.log('üìã App inizializzata:', {
                    gameDate: app.gameDate,
                    gameHour: app.gameHour,
                    printCapacity: app.printCapacity
                });
                
                // Aggiungi contratto
                const contractData = {
                    name: 'snifferstop',
                    quantity: 298623,
                    deadline: '1999-02',
                    priority: 'normal'
                };
                
                app.contractManager.addContract(contractData);
                console.log('‚úÖ Contratto aggiunto');
                
                // Aggiorna analisi
                app.updateAnalysis();
                
                console.log('‚úÖ Test app completato');
                
            } catch (error) {
                console.log(`‚ùå Errore test app completa: ${error.message}`);
            }
        }
    </script>
</body>
</html>
